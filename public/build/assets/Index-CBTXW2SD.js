import{r as t,j as s,Y as R,a as L,y as v}from"./app-DWiplGih.js";import{M as k}from"./MyPagination-qmxJVFS1.js";import"./SweetAlert-_wzJVbyC.js";import"./bootstrap.esm-Bb0rKlaf.js";import{A as U}from"./AuthenticatedLayout-RN_dLH_b.js";import"./jquery-TLgHKWof.js";import"./index-C5nD6nVr.js";import"./Loder-D9bdZO9o.js";import"./MyImage-BxCI3zcA.js";const V=({auth:N,title:g,transactions:c,gateways:i})=>{const[o,y]=t.useState(new URLSearchParams(window.location.search).get("s")||""),[n,S]=t.useState(new URLSearchParams(window.location.search).get("gateway")||""),[h,w]=t.useState(new URLSearchParams(window.location.search).get("date")||""),[x,E]=t.useState(""),[p,D]=t.useState(""),[P,r]=t.useState(!1),[u,j]=t.useState(!1),m=(e,a=null,l=null)=>{e.preventDefault();const d={gateway:n,s:o,date:h};a&&(d[a]=l),v.get(route("transactions"),d,{preserveState:!0})},C=async e=>{await v.get(route("transactions"),{page:e,s:o,gateway:n},{preserveState:!0})},_=async()=>{try{j(!0),r(!0);const e=await axios.post(route("transactions.export"),{start_date:x,end_date:p},{responseType:"blob"}),a=window.URL.createObjectURL(new Blob([e.data],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"})),l=document.createElement("a");l.href=a,l.download="transactions_export.xlsx",document.body.appendChild(l),l.click(),l.remove(),window.URL.revokeObjectURL(a)}catch(e){console.error("Error exporting transactions:",e)}finally{j(!1),r(!1)}};return s.jsxs(U,{user:N.user,children:[s.jsx(R,{title:g}),s.jsxs("div",{className:"card-box table-responsive",children:[s.jsxs("div",{className:"row",children:[s.jsx("div",{className:"col-sm-3 app-search",children:s.jsxs("select",{className:"form-control",name:"gateway",defaultValue:n,onChange:e=>{S(e.target.value),m(e,"gateway",e.target.value)},children:[s.jsx("option",{value:"",children:"Filter by gateway"}),i&&i.map(e=>s.jsx("option",{value:e==null?void 0:e.name,children:e==null?void 0:e.name},e==null?void 0:e.id))]})}),s.jsx("div",{className:"col-md-4",children:s.jsxs("form",{className:"app-search",onSubmit:e=>m(e,"s",o),role:"form",children:[s.jsx("input",{className:"form-control",type:"text",name:"s",placeholder:"Search By Payment ID OR Email...",value:o,onChange:e=>y(e.target.value)}),s.jsx("button",{type:"submit",children:s.jsx("i",{className:"fa fa-search"})})]})}),s.jsx("div",{className:"col-md-2 app-search",children:s.jsx("input",{style:{paddingRight:"10px"},className:"form-control",type:"date",name:"date",placeholder:"Search by date",value:h,onChange:e=>{w(e.target.value),m(e,"date",e.target.value)}})}),s.jsx("div",{className:"col-md-3",children:s.jsxs("button",{onClick:()=>r(!0),className:"btn btn-info btn-md waves-effect waves-light m-b-20 mt-2 pull-right",children:[s.jsx("i",{className:"fa fa-file-excel-o"})," Export Transactions"]})})]}),s.jsx("div",{className:"table-responsive",children:s.jsxs("table",{className:"table table-bordered",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Name"}),s.jsx("th",{children:"Email"}),s.jsx("th",{children:"Plan"}),s.jsx("th",{children:"Amount"}),s.jsx("th",{children:"Payment Gateway"}),s.jsx("th",{children:"Payment ID"}),s.jsx("th",{children:"Payment Date"})]})}),s.jsx("tbody",{children:c.data.map(e=>{var a,l,d,b,f;return s.jsxs("tr",{children:[s.jsx("td",{children:s.jsx(L,{style:{color:"#007bff"},href:route("admin.users.show",e==null?void 0:e.user_id),children:(a=e==null?void 0:e.user)==null?void 0:a.name})}),s.jsx("td",{children:(l=e==null?void 0:e.user)==null?void 0:l.email}),s.jsx("td",{children:(b=(d=e==null?void 0:e.user)==null?void 0:d.subscription_plan)==null?void 0:b.name}),s.jsx("td",{children:e.amount}),s.jsx("td",{children:(f=e==null?void 0:e.gateway)==null?void 0:f.name}),s.jsx("td",{children:e==null?void 0:e.transaction_id}),s.jsx("td",{children:new Date(e==null?void 0:e.created_at).toLocaleString()})]},e==null?void 0:e.id)})})]})}),s.jsx(k,{currentPage:c.current_page,lastPage:c.last_page,onPageChange:C}),P&&s.jsx("div",{id:"export_model",className:"modal fade show",style:{display:"block"},children:s.jsx("div",{className:"modal-dialog",children:s.jsxs("div",{className:"modal-content",children:[s.jsxs("div",{className:"modal-header",children:[s.jsx("h4",{className:"modal-title",children:"Export Transactions"}),s.jsx("button",{type:"button",className:"close",onClick:()=>r(!1),children:"Ã—"})]}),s.jsxs("div",{className:"modal-body",children:[s.jsxs("div",{className:"form-group row",children:[s.jsx("label",{className:"col-sm-3 col-form-label",children:"Start Date"}),s.jsx("div",{className:"col-sm-9",children:s.jsx("input",{type:"date",name:"start_date",placeholder:"Start Date",className:"form-control",value:x,onChange:e=>E(e.target.value),required:!0})})]}),s.jsxs("div",{className:"form-group row mb-0",children:[s.jsx("label",{className:"col-sm-3 col-form-label",children:"End Date"}),s.jsx("div",{className:"col-sm-9",children:s.jsx("input",{type:"date",name:"end_date",placeholder:"End Date",className:"form-control",value:p,onChange:e=>D(e.target.value),required:!0})})]})]}),s.jsxs("div",{className:"modal-footer",children:[s.jsx("button",{type:"button",className:"btn btn-secondary",onClick:()=>r(!1),children:"Close"}),s.jsx("button",{type:"button",className:"btn btn-primary",onClick:_,disabled:u,children:u?"Exporting...":"Export"})]})]})})})]})]})};export{V as default};
